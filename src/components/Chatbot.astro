---
// Chatbot Component - Basílica de Los Ángeles
---

<!-- Floating Chat Button -->
<button
  id="chat-toggle"
  class="fixed bottom-6 right-6 z-50 bg-primary hover:bg-primaryDark text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110"
  aria-label="Abrir chat"
>
  <svg id="chat-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
  </svg>
  <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
  </svg>
</button>

<!-- Chat Window -->
<div
  id="chat-window"
  class="fixed bottom-24 right-6 z-50 w-80 sm:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 hidden flex-col overflow-hidden"
  style="height: 500px; max-height: 70vh;"
>
  <!-- Header -->
  <div class="bg-primary text-white px-4 py-3 flex items-center gap-3">
    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
      </svg>
    </div>
    <div>
      <h3 class="font-semibold text-sm">Asistente Virtual</h3>
      <p class="text-xs text-white/80">Basílica de Los Ángeles</p>
    </div>
  </div>

  <!-- Messages Container -->
  <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50">
    <!-- Welcome message -->
    <div class="flex gap-2">
      <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
      </div>
      <div class="bg-white rounded-lg rounded-tl-none px-3 py-2 shadow-sm max-w-[80%]">
        <p class="text-sm text-slate-700">¡Bienvenido! Soy el asistente virtual de la Basílica de Los Ángeles. ¿En qué puedo ayudarle?</p>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="p-3 border-t border-slate-200 bg-white">
    <form id="chat-form" class="flex gap-2">
      <input
        type="text"
        id="chat-input"
        placeholder="Escriba su mensaje..."
        class="flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary"
        autocomplete="off"
      />
      <button
        type="submit"
        class="bg-primary hover:bg-primaryDark text-white px-4 py-2 rounded-lg transition-colors"
        aria-label="Enviar mensaje"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
        </svg>
      </button>
    </form>
  </div>
</div>

<script>
  const chatToggle = document.getElementById('chat-toggle');
  const chatWindow = document.getElementById('chat-window');
  const chatIcon = document.getElementById('chat-icon');
  const closeIcon = document.getElementById('close-icon');
  const chatForm = document.getElementById('chat-form');
  const chatInput = document.getElementById('chat-input') as HTMLInputElement;
  const chatMessages = document.getElementById('chat-messages');

  let isOpen = false;

  chatToggle?.addEventListener('click', () => {
    isOpen = !isOpen;
    chatWindow?.classList.toggle('hidden', !isOpen);
    chatWindow?.classList.toggle('flex', isOpen);
    chatIcon?.classList.toggle('hidden', isOpen);
    closeIcon?.classList.toggle('hidden', !isOpen);
    if (isOpen) chatInput?.focus();
  });

  chatForm?.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = chatInput?.value.trim();
    if (!message) return;

    // Add user message
    addMessage(message, 'user');
    chatInput.value = '';

    // Simulate bot response (placeholder)
    setTimeout(() => {
      addMessage('Gracias por su mensaje. Esta función estará disponible pronto.', 'bot');
    }, 500);
  });

  function addMessage(text: string, sender: 'user' | 'bot') {
    const messageDiv = document.createElement('div');
    messageDiv.className = sender === 'user' ? 'flex gap-2 justify-end' : 'flex gap-2';
    
    if (sender === 'bot') {
      messageDiv.innerHTML = `
        <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
        </div>
        <div class="bg-white rounded-lg rounded-tl-none px-3 py-2 shadow-sm max-w-[80%]">
          <p class="text-sm text-slate-700">${text}</p>
        </div>
      `;
    } else {
      messageDiv.innerHTML = `
        <div class="bg-primary text-white rounded-lg rounded-tr-none px-3 py-2 shadow-sm max-w-[80%]">
          <p class="text-sm">${text}</p>
        </div>
      `;
    }

    chatMessages?.appendChild(messageDiv);
    chatMessages?.scrollTo({ top: chatMessages.scrollHeight, behavior: 'smooth' });
  }
</script>